<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Zephyrus | Login</title>

  <script src="./js/sessao.js"></script>

  <link rel="stylesheet" href="./css/forms.css" />
  <link rel="icon" href="../assets/imgs/Zephyrus_2png.png" />
  <link rel="preconnect" href="https://fonts.gstatic.com" />
</head>

<body>
  <main id="formulario-main">
    <div class="esquerda">
      <div class="imagem-lateral">
        <img src="assets/imgs/fundoLogin.jpg" alt="Família no mercado" />
      </div>
    </div>
    <div class="direita">
      <div class="voltarCadastro">
        <a href="./index.html">
          <span>Voltar</span>
          <i class="fa-solid fa-arrow-right"></i>
        </a>
      </div>
      <div class="formulario-login">
        <div class="logo">
          <h1>Zephyrus</h1>
        </div>
        <div class="formulario">
          <div class="formulario-principal">
            <label for="">Endereço de email</label>
            <input type="email" id="email_input" placeholder="email*" class="ipt_digitar" />
            <div id="output_email"></div>
            <label for="">Senha</label>
            <input type="password" id="senha_input" placeholder="senha*" class="ipt_digitar" />
            <div id="output_senha"></div>
            <div id="erro" style="display: none; color: red"> E-mail ou Senha inválido!</div>
            <div class="parte-checkbox">
              <input type="checkbox" id="lembrarCheck" />
              <label for="lembrarCheck">Lembre-se de mim</label>
            </div>

            <button onclick="entrar()">Entrar</button>
          </div>
          <div class="nao-cliente">
            <p>
              Ainda não é um cliente?
              <span><a href="index.html#contato">Entre em contato</a></span>
            </p>
          </div>
        </div>
      </div>
    </div>
  </main>
</body>

</html>

<script>

  window.onload = () => {
  const lembrarEmail = localStorage.getItem("email")
  const lembrarSenha = localStorage.getItem("senha")
  if (lembrarEmail && lembrarSenha) {
    email_input.value = lembrarEmail
    senha_input.value = lembrarSenha

    document.getElementById("lembrarCheck").checked = true
  }
}

function entrar() {
  const emailVar = email_input.value
  const senhaVar = senha_input.value
  const lembrar = document.getElementById("lembrarCheck").checked
  const erro = document.getElementById("erro")


  if (!emailVar || !senhaVar) {
      erro.style.display = "block"
      erro.innerHTML = "Preencha todos os campos!"
      return false
  }

  if (lembrar) {
    localStorage.setItem("email", emailVar)
    localStorage.setItem("senha", senhaVar)
  } else {
    localStorage.removeItem("email")
    localStorage.removeItem("senha")
  }

  fetch("/usuarios/autenticar", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ emailServer: emailVar, senhaServer: senhaVar })
  })
  .then(resposta => {
    if (resposta.ok) {
      resposta.json().then(json => {
        sessionStorage.EMAIL_USUARIO = json.email
        sessionStorage.NOME_USUARIO = json.nome
        sessionStorage.ID_USUARIO = json.id_usuario
        sessionStorage.CARGO_USUARIO = json.perfil
        setTimeout(() => window.location = "../dashboard/mainPage.html", 1000)
      })
    } else {
      resposta.text().then(texto => {
        console.error(texto)
        erro.style.display = "block"
        erro.innerHTML = "E-mail ou senha inválidos!"
        finalizarAguardar(texto)
      })
    }
  })
  .catch(erro => console.log(erro))

  return false
}


  // function sumirMensagem() {
  //     cardErro.style.display = "none"
  // }
</script>