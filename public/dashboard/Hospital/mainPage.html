<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./../../css/dashboards.css">
  <link rel="icon" href="/assets/imgs/Zephyrus_2png.png" />
  <title>Dashboard - Página Principal</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script>
  <script src="../../js/sessao.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


</head>

<body onload="hospital()">
  <div class="div-pai">

    <!-- Cabeçalho -->
    <header style="position: fixed; z-index: 1000;">
      <div class="header-container">
        <div class="div-hamburguer" onclick="toggleSidebar()">
          <!-- Botão Hamburguer -->
          <a class="navbar-mob">
            <i id="icone" class="fa-solid fa-bars"></i>
          </a>
        </div>
        <h2>DASHBOARD - PÁGINA PRINCIPAL</h2>
        <div class="div-pai-perfil">
          <div class="div-linha"></div>
          <div class="div-todo-perfil">
            <div class="div-filho-perfil">
              <img src="../../assets/imgs/profile.png" alt="imagem de perfil" class="img-perfil" />
              <img src="../../assets/imgs/seta-para-baixo-braca.png" alt="ver opções" class="img-seta" />
            </div>
            <div class="div-opcoes">
              <div class="div-opcao-sair">
                <button style="border: none;" onclick="limparSessao()" id="sair"><span>Sair</span></button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <br><br><br><br>
    <!-- Sidebar Modal -->
    <div id="sidebarModal" class="sidebar-modal">
      <img src="/assets/imgs/Zephyrus_2png.png" alt="">
      <div class="sidebar-header">
        <span>Menu</span>
        <button onclick="toggleSidebar()" class="btn-fechar">&times;</button>
      </div>
      <nav class="sidebar-nav">
        <a class="pgAtual" href="./mainPage.html">Página principal</a>
        <a href="./controleSalas.html">Salas</a>
        <a href="./contas.html">Contas</a>
      </nav>
    </div>
    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; margin-top: 10px;">
      <h3 id="data-atual"> Última Atualização: </h3>
      <h3>Dados do dia:</h3>
    </div>
    <div class="conteudo-principal">
      <div class="KPIs">
        <div class="kpiDash">
          <div class="DadosKPI">
            <h3 style="font-size: 4vh;">03</h3>
            <p> Máquinas com mais de 80% ou 0% de <b>RAM</b></p>
          </div>
          <div style="display: flex; align-items: center; height: 100%;" class="imagemKPI">
            <div style="background-color: red;" class="circulo"> <img src="../../assets/imgs/ram.png"></div>
          </div>
        </div>
        <div class="kpiDash">
          <div class="DadosKPI">
            <h3 style="font-size: 4vh;">01</h3>
            <p> Máquinas com mais de 80% ou 0% de <b>CPU</b></p>
          </div>
          <div style="display: flex; align-items: center; height: 100%;" class="imagemKPI">
            <div style="background-color: red;" class="circulo"> <img src="../../assets/imgs/cpu.png"></div>
          </div>
        </div>
        <div class="kpiDash">
          <div class="DadosKPI">
            <h3 style="font-size: 4vh;">00</h3>
            <p> Máquinas com mais de 80% ou 0% de <b>Disco</b></p>
          </div>
          <div style="display: flex; align-items: center; height: 100%;" class="imagemKPI">
            <div style="background-color: green;" class="circulo"> <img src="../../assets/imgs/disco.png"></div>
          </div>
        </div>
        <div class="kpiDash">
          <div class="DadosKPI">
            <h3 style="font-size: 4vh;">00</h3>
            <p> Máquinas com <b>Processos</b> excedentes</p>
          </div>
          <div style="display: flex; align-items: center; height: 100%;" class="imagemKPI">
            <div style="background-color: green;" class="circulo"> <img src="../../assets/imgs/processos.png"></div>
          </div>
        </div>
        <div class="kpiDash">
          <div class="DadosKPI">
            <h3 style="font-size: 4vh;">01</h3>
            <p> Máquinas com menos de 20% de <b>Bateria</b></p>
          </div>
          <div style="display: flex; align-items: center; height: 100%;" class="imagemKPI">
            <div style="background-color: red;" class="circulo"> <img src="../../assets/imgs/bateria.png"></div>
          </div>
        </div>
      </div>
      <div class="Containertabela">
        <div class="graficoHeader">Últimos alertas:</div>
        <div class="tabelaWrapper">
          <table class="graficoTabela">
            <thead>
              <tr>
                <th>Data</th>
                <th>Nº Série</th>
                <th>Modelo</th>
                <th>Área</th>
                <th style="width: 25%;">Parâmetro Atingido</th>
                <th>Consumo</th>
                <th>Unidade</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>30/10/2025 12:00</td>
                <td>VNT-DRG-0001</td>
                <td>Dräger Evita Infinity V500</td>
                <td>UTI</td>
                <td>RAM</td>
                <td>91</td>
                <td>%</td>
              </tr>
              <tr>
                <td>30/10/2025 11:47</td>
                <td>VNT-DRG-0106</td>
                <td>Hamilton-C6</td>
                <td>UTI</td>
                <td>CPU</td>
                <td>90</td>
                <td>%</td>
              </tr>
              <tr>
                <td>30/10/2025 11:40</td>
                <td>VNT-DRG-212</td>
                <td>Hamilton-C6</td>
                <td>UTI</td>
                <td>RAM</td>
                <td>87</td>
                <td>%</td>
              </tr>
              <tr>
                <td>30/10/2025 11:20</td>
                <td>VNT-DRG-506</td>
                <td>Hamilton-C6</td>
                <td>UTI</td>
                <td>RAM</td>
                <td>81</td>
                <td>%</td>
              </tr>
              <tr>
                <td>30/10/2025 11:10</td>
                <td>VGG-HGL-0137</td>
                <td>Magnamed OxyMag</td>
                <td>Pronto-Socorro</td>
                <td>Bateria</td>
                <td>14</td>
                <td>%</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="graficos">
        <div class="graficoContainer">
          <div class="graficoHeader">Intercorrência de componente:</div>
          <div style="width: 100%; height: 100%;">
          <canvas id="Intercorrenciaporcomponente"></canvas>
          </div>
        </div>
        <div class="graficoContainer">
          <div class="graficoHeader">Intercorrência gerais por área:</div>
          <div style="width: 100%; height: 100%;">
          <canvas id="Intercorrenciaporarea"></canvas>
          </div>
        </div>
      </div>
     
    </div>

  </div>


  </div>
</body>

</html>
<script src="../js/chart.js"></script>

<script>

  let agora = new Date();
  
  let dataFormatada = agora.toLocaleDateString();
  let horaFormatada = agora.toLocaleTimeString();

  let elementoData = document.getElementById("data-atual");
  
  elementoData.textContent += ` ${dataFormatada} ${horaFormatada}`;
  

  async function hospital() {
    const resposta = await fetch(`/controle/hospitais/${sessionStorage.getItem("HOSPITAL_USUARIO")}`);
    const hospital = await resposta.json();
    console.log(hospital)
    sessionStorage.NOME_HOSPITAL_ATUAL = hospital[0].nomeHospital;
  }
  
  function toggleSidebar() {
    const sidebar = document.getElementById("sidebarModal");
    const icone = document.getElementById("icone");
    
    sidebar.classList.toggle("active");
  }
  
  function mostrarNavbar() {
    const larguraTela = window.innerWidth;
    var menu = document.getElementById("navbar");
    var icone = document.getElementById("icone");
    
    if (larguraTela < 1342) {
      if (getComputedStyle(menu).display == 'none') {
        menu.style.display = "flex";
        icone.classList.remove("fa-bars");
        icone.classList.add("fa-times");
      } else {
        menu.style.display = "none";
        icone.classList.remove("fa-times");
        icone.classList.add("fa-bars");
      }
    }
  }
  function Sair() {
    const sair = document.getElementById("sair")
    
    if (sair) {
      localStorage.removeItem("email")
      localStorage.removeItem("senha")
      
      sessionStorage.clear()
      console.log(sessionStorage)
      
      window.location.href = "../../index.html"
    }
  }

  var componentes = ["RAM","CPU","DISCO","PROCESSOS","BATERIA"];
  var intercorrenciacomponente = [10,10,10,24,1];

  let grafico;

  if (grafico) grafico.destroy();
  
    const grafIntercorrenciaporcomponente = document.getElementById('Intercorrenciaporcomponente');
    grafIntercorrenciaporcomponente.width = "100%";
    grafIntercorrenciaporcomponente.height = "20vh";
  
    grafico = new Chart(grafIntercorrenciaporcomponente, {
      type: 'bar',
      data: {
        labels: componentes,
        datasets: [{
          backgroundColor: '#264653',
          label: 'Total de intercorrências',
          data: intercorrenciacomponente,
          borderWidth: 2,
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              font: {
                size: 20
              }
            }
          },
          x: {
            ticks: {
              maxRotation: 0,
              minRotation: 0,
              font: {
                size: 20
              }
            }
          }
        }
      }
    });
  var componentes = ["UTI","Neonatal","Pronto-Socorro","Internação","Centro Cirúrgico"];
  var alertasArea = [35,20,10,5,3];

  let grafico2;

  if (grafico2) grafico2.destroy();
  
    const grafIntercorrenciaporarea = document.getElementById('Intercorrenciaporarea');
    grafIntercorrenciaporarea.width = "100%";
    grafIntercorrenciaporarea.height = "20vh";
  
    grafico2 = new Chart(grafIntercorrenciaporarea, {
      type: 'bar',
      data: {
        labels: componentes,
        datasets: [{
          backgroundColor: '#264653',
          label: 'Total de intercorrências',
          data: alertasArea,
          borderWidth: 2,
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              font: {
                size: 20
              }
            }
          },
          x: {
            ticks: {
              maxRotation: 0,
              minRotation: 0,
              font: {
                size: 20
              }
            }
          }
        }
      }
    });

    
</script>