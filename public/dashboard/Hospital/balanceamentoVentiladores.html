<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Balanceamento de Ventiladores</title>
  <link rel="icon" href="/assets/imgs/Zephyrus_2png.png">
  <link rel="stylesheet" href="./../../css/dashboards.css">
  <link rel="stylesheet" href="./../../css/dashboardFelipe.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <script src="../../js/sessao.js"></script>

</head>

<body onload="hospital()">
  <div class="div-pai">

    <header style="position: fixed; z-index: 1000;">
      <div class="header-container">
        <div class="div-hamburguer" onclick="toggleSidebar()">
          <a class="navbar-mob">
            <i id="icone" class="fa-solid fa-bars"></i>
          </a>
        </div>
        <h2>BALANCEAMENTO DE VENTILADORES</h2>
        <div class="div-pai-perfil">
          <div class="div-linha"></div>
          <div class="div-todo-perfil">
            <div class="div-filho-perfil">
              <img src="../../assets/imgs/profile.png" alt="imagem de perfil" class="img-perfil">
              <img src="../../assets/imgs/seta-para-baixo-braca.png" alt="ver opções" class="img-seta">
            </div>
            <div class="div-opcoes">
              <div class="div-opcao-sair">
                <button style="border: none;" onclick="limparSessao()" id="sair"><span>Sair</span></button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <br><br><br><br>

    <div id="sidebarModal" class="sidebar-modal">
      <img src="/assets/imgs/Zephyrus_2png.png" alt="">
      <div class="sidebar-header">
        <span>Menu</span>
        <button onclick="toggleSidebar()" class="btn-fechar">&times;</button>
      </div>
      <nav class="sidebar-nav">
        <a href="./mainPage.html">Página principal</a>
        <a class="pgAtual" href="./balanceamentoVentiladores.html">Balanceamento</a>
        <a href="./controleSalas.html">Salas</a>
        <a href="./contas.html">Contas</a>
        <a style="margin-top: 700px;" href="https://suaempresa.atlassian.net/secure/CreateIssue!default.jspa"
          target="_blank">Abrir Chamado <i class="fa-solid fa-headset"></i></a>
      </nav>
    </div>

    <div class="conteudo-monitoramento">
      <div class="container-monitoramento">

        <div class="caixa-padrao">
          <div class="cabecalho-grafico">Análise Preditiva e Riscos</div>
          <div class="corpo-caixa">
            <div class="layout-duas-colunas">

              <div class="coluna-empilhada">
                <div class="secao-analise">
                  <div class="cabecalho-secao">
                    <div class="icone-secao vermelho"><i data-lucide="alert-triangle"></i></div>
                    <div>
                      <h3 class="titulo-secao">Análise de Risco</h3>
                      <p class="subtitulo-secao">Monitoramento sazonal</p>
                    </div>
                  </div>
                  <div class="grade-risco">
                    <div>
                      <div class="rotulo-risco">Relatório Histórico</div>
                      <div class="valor-risco">Pico de Umidade</div>
                      <div class="sub-risco">Agosto/Setembro (3 meses atrás)</div>
                    </div>
                    <div>
                      <div class="rotulo-risco">Risco Atual</div>
                      <div class="valor-risco perigo">Alto</div>
                      <div class="sub-risco">Novembro/Dezembro (Alta Demanda)</div>
                    </div>
                  </div>
                </div>

                <div class="secao-analise">
                  <div class="cabecalho-secao">
                    <div class="icone-secao azul"><i data-lucide="lightbulb"></i></div>
                    <div>
                      <h3 class="titulo-secao">Recomendação</h3>
                      <p class="subtitulo-secao">Ação sugerida de balancemento dos ventiladores</p>
                    </div>
                  </div>
                  <div class="valor-recomendacao">Reforçar UTI e Pronto Socorro</div>
                  <div class="acao-recomendacao">
                    <i data-lucide="arrow-right"></i>
                    <span>Remanejamento: <span id="totalRemanejamento"></span> ventiladores disponíveis</span>
                  </div>
                </div>
              </div>

              <div class="secao-analise altura-total">
                <div class="cabecalho-secao">
                  <div class="icone-secao laranja"><i data-lucide="file-text"></i></div>
                  <div>
                    <h3 class="titulo-secao">Áreas Críticas</h3>
                    <p class="subtitulo-secao">Necessitam atenção imediata</p>
                  </div>
                </div>
                <div id="containerAreasCriticas"></div>
              </div>

            </div>
          </div>
        </div>

        <div class="grade-kpis">

          <div class="cartao-kpi borda-verde">
            <div class="linha-conteudo-kpi">
              <div class="lado-texto-kpi">
                <p class="titulo-kpi">Estabilidade Operacional</p>
                <h3 class="valor-kpi"><span id="textoEstaveis"></span>/<span id="textoTotalVentiladores"></span>
                  Estáveis</h3>
                <p class="subtitulo-kpi">Quantidade de ventiladores estáveis em relação ao total<br>de ventiladores</p>
              </div>
              <div class="lado-grafico-kpi">
                <div id="graficoEstabilidadeKpi"></div>
              </div>
            </div>
          </div>

          <div class="cartao-kpi borda-vermelha">
            <div class="linha-conteudo-kpi">
              <div class="lado-texto-kpi">
                <p class="titulo-kpi">Índice de Alertas</p>
                <h3 class="valor-kpi"><span id="textoAlertasAreaCritica"></span> de <span id="textoTotalAlertas"></span>
                  na <strong id="textoNomeAreaCritica">UTI</strong></h3>
                <p class="subtitulo-kpi">Quantidade de ventiladores em alerta na área mais crítica<br>em relação ao
                  total de ventiladores em alerta</p>
              </div>
              <div class="lado-grafico-kpi">
                <div id="graficoAlertasKpi"></div>
              </div>
            </div>
          </div>

        </div>

        <div class="caixa-padrao">
          <div class="cabecalho-grafico">
            Distribuição e Balanceamento
            <span class="etiqueta-cabecalho">Total: <span id="exibicaoTotalVentiladores"></span> Unidades</span>
          </div>
          <div class="corpo-caixa">
            <div class="linha-subtitulo-distribuicao">
              <p>Monitoramento de hardware e recomendações de remanejamento por área hospitalar</p>
            </div>
            <div class="grade-areas" id="gradeAreas"></div>
          </div>
        </div>

        <div class="caixa-padrao">
          <div class="cabecalho-grafico">Evolução Mensal da Umidade (São Paulo)</div>
          <div class="corpo-caixa">
            <div id="graficoUmidade" style="height: 350px;"></div>
            <div class="alerta-umidade-perigo">
              <i data-lucide="alert-triangle"></i>
              <span>Pico de umidade em Agosto: aumento de internações nos meses subsequentes.</span>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    function toggleSidebar() {
      document.getElementById("sidebarModal").classList.toggle("active");
    }

    var areas = [
      { nome: "UTI", total: 20, estaveis: 13, alertas: 7, risco: 45, precisa: 6, podeEnviar: 0 },
      { nome: "Pronto Socorro", total: 12, estaveis: 8, alertas: 4, risco: 33, precisa: 4, podeEnviar: 0 },
      { nome: "Maternidade", total: 7, estaveis: 6, alertas: 1, risco: 14, precisa: 0, podeEnviar: 2 },
      { nome: "Cirurgia", total: 8, estaveis: 7, alertas: 1, risco: 12, precisa: 0, podeEnviar: 3 },
      { nome: "Centro Obstétrico", total: 10, estaveis: 9, alertas: 1, risco: 8, precisa: 0, podeEnviar: 3 },
      { nome: "Oncologia", total: 9, estaveis: 8, alertas: 1, risco: 11, precisa: 0, podeEnviar: 2 },
      { nome: "Cardiologia", total: 6, estaveis: 6, alertas: 0, risco: 0, precisa: 0, podeEnviar: 0 },
      { nome: "Pneumologia", total: 5, estaveis: 5, alertas: 0, risco: 0, precisa: 0, podeEnviar: 0 }
    ];

    var totalVentiladores = 0;
    var totalEstaveis = 0;
    var totalAlertas = 0;
    var totalPodeEnviar = 0;

    for (var i = 0; i < areas.length; i++) {
      totalVentiladores = totalVentiladores + areas[i].total;
      totalEstaveis = totalEstaveis + areas[i].estaveis;
      totalAlertas = totalAlertas + areas[i].alertas;
      totalPodeEnviar = totalPodeEnviar + areas[i].podeEnviar;
    }

    var porcentagemEstabilidade = Math.round((totalEstaveis / totalVentiladores) * 100);

    var areaMaisCritica = areas[0];
    for (var i = 1; i < areas.length; i++) {
      if (areas[i].alertas > areaMaisCritica.alertas) {
        areaMaisCritica = areas[i];
      }
    }

    var porcentagemAlertas = Math.round((areaMaisCritica.alertas / totalAlertas) * 100);

    document.getElementById('textoEstaveis').textContent = totalEstaveis;
    document.getElementById('textoTotalVentiladores').textContent = totalVentiladores;
    document.getElementById('textoTotalAlertas').textContent = totalAlertas;
    document.getElementById('textoAlertasAreaCritica').textContent = areaMaisCritica.alertas;
    document.getElementById('textoNomeAreaCritica').textContent = areaMaisCritica.nome;
    document.getElementById('totalRemanejamento').textContent = totalPodeEnviar;
    document.getElementById('exibicaoTotalVentiladores').textContent = totalVentiladores;

    new ApexCharts(document.querySelector("#graficoEstabilidadeKpi"), {
      series: [porcentagemEstabilidade],
      chart: { height: 160, type: 'radialBar' },
      plotOptions: {
        radialBar: {
          hollow: { size: '60%' },
          dataLabels: {
            name: { show: false },
            value: {
              show: true,
              fontSize: '24px',
              fontWeight: 800,
              color: '#30a799',
              offsetY: 8,
              formatter: function (val) { return val + "%" }
            }
          }
        }
      },
      colors: ['#30a799']
    }).render();

    new ApexCharts(document.querySelector("#graficoAlertasKpi"), {
      series: [porcentagemAlertas],
      chart: { height: 160, type: 'radialBar' },
      plotOptions: {
        radialBar: {
          hollow: { size: '60%' },
          dataLabels: {
            name: { show: false },
            value: {
              show: true,
              fontSize: '24px',
              fontWeight: 800,
              color: '#e60e3a',
              offsetY: 8,
              formatter: function (val) { return val + "%" }
            }
          }
        }
      },
      colors: ['#e60e3a']
    }).render();

    var containerCriticas = document.getElementById('containerAreasCriticas');
    var areasCriticas = [];
    for (var i = 0; i < areas.length; i++) {
      if (areas[i].alertas > 0) {
        areasCriticas.push(areas[i]);
      }
    }

    for (var i = 0; i < areasCriticas.length && i < 4; i++) {
      var area = areasCriticas[i];
      var corBarra = 'verde';
      if (area.risco > 40) corBarra = 'vermelho';
      else if (area.risco >= 10) corBarra = 'amarelo';

      var div = document.createElement('div');
      div.className = 'item-area-critica';
      div.innerHTML = '<div class="barra-critica ' + corBarra + '"></div><div><span class="nome-area-critica">' + area.nome + '</span><br><span class="detalhes-criticos">' + area.risco + '% Risco • ' + area.alertas + ' ventiladores com alerta</span></div>';
      containerCriticas.appendChild(div);
    }

    var gradeAreas = document.getElementById('gradeAreas');
    for (var i = 0; i < areas.length; i++) {
      var area = areas[i];
      var percentualEstabilidade = Math.round((area.estaveis / area.total) * 100);
      var tipoArea = '';
      var textoEtiqueta = 'Estável';
      var classeEtiqueta = 'neutro';

      if (area.precisa > 0) {
        tipoArea = 'precisa-ventiladores';
        textoEtiqueta = 'Necessita';
        classeEtiqueta = 'precisa';
      } else if (area.podeEnviar > 0) {
        tipoArea = 'pode-enviar';
        textoEtiqueta = 'Disponível';
        classeEtiqueta = 'enviar';
      }

      var htmlAcao = '';
      if (area.precisa > 0) {
        htmlAcao = '<div class="caixa-recomendacao-area"><div class="cabecalho-recomendacao"><i data-lucide="lightbulb"></i> Recomendação</div><div class="texto-recomendacao">Adicionar <strong>+' + area.precisa + ' ventiladores</strong></div></div><div class="caixa-disponivel"><div class="esquerda-disponivel"><i data-lucide="package"></i> Disponível para envio</div><span class="valor-disponivel zero">0</span></div>';
      } else if (area.podeEnviar > 0) {
        htmlAcao = '<div class="caixa-envio-area"><div class="cabecalho-envio"><i data-lucide="send"></i> Pode Enviar</div><div class="texto-envio">Enviar <strong>' + area.podeEnviar + ' ventiladores</strong></div></div><div class="caixa-disponivel"><div class="esquerda-disponivel"><i data-lucide="package"></i> Disponível para envio</div><span class="valor-disponivel positivo">' + area.podeEnviar + '</span></div>';
      } else {
        htmlAcao = '<div class="caixa-disponivel"><div class="esquerda-disponivel"><i data-lucide="package"></i> Disponível para envio</div><span class="valor-disponivel zero">0</span></div>';
      }

      var cartaoArea = document.createElement('div');
      cartaoArea.className = 'cartao-area ' + tipoArea;
      cartaoArea.innerHTML = '<div class="cabecalho-area"><h3 class="nome-area">' + area.nome + '</h3><div class="etiqueta-area ' + classeEtiqueta + '">' + textoEtiqueta + '</div></div><div class="estatisticas-area"><div class="item-estatistica"><div class="rotulo-estatistica">Atual</div><div class="valor-estatistica">' + area.total + '</div></div><div class="item-estatistica"><div class="rotulo-estatistica">Pode Ceder</div><div class="valor-estatistica sucesso">' + area.podeEnviar + '</div></div><div class="item-estatistica"><div class="rotulo-estatistica">Precisa</div><div class="valor-estatistica destaque">' + area.precisa + '</div></div></div><div class="secao-estabilidade"><div class="cabecalho-estabilidade"><span>Estabilidade</span><span>' + percentualEstabilidade + '%</span></div><div class="barra-estabilidade"><div class="preenchimento-barra-estabilidade" style="width: ' + percentualEstabilidade + '%"></div></div></div><div class="grade-status"><div class="item-status estavel"><i data-lucide="check-circle-2"></i><span>' + area.estaveis + '</span></div><div class="item-status alerta"><i data-lucide="x-circle"></i><span>' + area.alertas + '</span></div></div>' + htmlAcao;
      gradeAreas.appendChild(cartaoArea);
    }

    lucide.createIcons();

    var dadosUmidade = [65, 67, 70, 69, 70, 72, 75, 94, 87, 76, 74, 0];
    var coresUmidade = [];
    for (var i = 0; i < dadosUmidade.length; i++) {
      if (dadosUmidade[i] > 90) {
        coresUmidade.push('#e60e3a');
      } else {
        coresUmidade.push('#30a799');
      }
    }

    new ApexCharts(document.querySelector("#graficoUmidade"), {
      chart: { type: 'bar', height: 350, toolbar: { show: false } },
      series: [{ name: 'Umidade', data: dadosUmidade }],
      xaxis: { categories: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'] },
      colors: coresUmidade,
      plotOptions: { bar: { distributed: true, borderRadius: 4, columnWidth: '50%' } },
      legend: { show: false },
      dataLabels: { enabled: false }
    }).render();
  </script>
</body>

</html>