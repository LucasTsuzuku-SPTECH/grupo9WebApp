<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./../../css/dashboardsCanuto.css">
    <link rel="icon" href="/assets/imgs/Zephyrus.ico" />
    <title>Dashboard - Página Principal</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script>
    <script src="../../js/sessao.js"></script>
</head>

<body onload="inicializacao()">
    <div class="div-pai">
        <!-- Cabeçalho -->
        <header style="position: fixed; z-index: 1000;">
            <div class="header-container">
                <div class="div-hamburguer" onclick="toggleSidebar()">
                    <!-- Botão Hamburguer -->
                    <a class="navbar-mob">
                        <i id="icone" class="fa-solid fa-bars"></i>
                    </a>
                </div>
                <h2>DASHBOARD - PÁGINA PRINCIPAL</h2>
                <div class="div-pai-perfil">
                    <div class="div-linha"></div>
                    <div class="div-todo-perfil">
                        <div class="div-filho-perfil">
                            <img src="../../assets/imgs/profile.png" alt="imagem de perfil" class="img-perfil" />
                            <img src="../../assets/imgs/seta-para-baixo-braca.png" alt="ver opções" class="img-seta" />
                        </div>
                        <div class="div-opcoes">
                            <div class="div-opcao-sair">
                                <button style="border: none;" onclick="limparSessao()"
                                    id="sair"><span>Sair</span></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <br><br><br>

        <div class="fastActions">
            <div>
                <h3 style="color: white;">Filtro de períodos:</h3>
                <select onchange="updatePeriodo()" class="selects" style="background-color: rgb(131, 203, 195);"
                    id="filtroPeriodo">
                    <option value="semanal">Semanal</option>
                    <option value="mensal">Mensal</option>
                    <option value="anual">Anual</option>
                </select>
            </div>

            <div style="display: flex; flex-direction: row;">
                <button class="Btn">Gerar relatório</button>
                <button class="Btn" id="btnIA" onclick="toggleAISidebar()">Analyst AI</button>
            </div>
        </div>


        <!-- Sidebar Modal -->
        <div id="sidebarModal" class="sidebar-modal">
            <img src="/assets/imgs/Zephyrus_2png.png" alt="">
            <div class="sidebar-header">
                <span>Menu</span>
                <button onclick="toggleSidebar()" class="btn-fechar">&times;</button>
            </div>
            <nav class="sidebar-nav">
                <a class="pgAtual" href="./mainEmpresaFunc.html">Página principal</a>
                <a href="./controleHospitais.html">Hospitais</a>
                <a href="./contas.html">Contas</a>
            </nav>
        </div>

        <!-- Sidebar da direita (IA) -->
        <div id="aiSidebar" class="ai-sidebar" aria-hidden="true">
            <div class="ai-header">
                <span>Analyst AI</span>
                <button onclick="toggleAISidebar()" class="btn-fechar">&times;</button>
            </div>
            <div class="ai-body">
                <p>Bem-vindo(a)! <br> Tenha uma análise mais profunda com o auxílio da Analyst AI:</p>
                <textarea id="aiInput" placeholder="Digite aqui..." rows="5"></textarea>
                <button class="Btn" onclick="sendToAI()">Enviar</button>
                <div id="aiResponse" style="margin-top:10px; color:#fff;"></div>
            </div>
        </div>



        <br><br><br><br>

        <div class="conteudo-main">
            <!-- Filtro e KPIs -->

            <div id="mainKPI" style="width: 100%; display: flex; flex-direction: column; justify-content: center;">
                <div style="width: 100%; display: flex; flex-direction: row; justify-content: center;">
                    <div class="kpiDashMain">

                        <h2
                            style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
                            RAM<img style="width: 80px; align-self: flex-end;"
                                src="/assets/imgs/iconsDashCanuto/alert.png"></h2>
                        <p style="height: 60px;">Componente com mais intercorrência</p>

                    </div>
                    <div class="kpiDashMain">
                        <h2
                            style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
                            100<img style="width: 80px; align-self: flex-end;"
                                src="/assets/imgs/iconsDashCanuto/alertMedium.png"></h2>
                        <p style="height: 60px;">Total de intercorrências</p>
                    </div>
                </div>

                <div style="width: 100%; display: flex; flex-direction: row; justify-content: center;">
                    <div class="kpiDash">
                        <h2
                            style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
                            25%<img style="width: 70px; align-self: flex-end;"
                                src="/assets/imgs/iconsDashCanuto/CPU.png"></h2>
                        <p style="height: 60px;">Intercorrências em CPU (25/100)</p>
                    </div>
                    <div class="kpiDash">
                        <h2
                            style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
                            50%<img style="width: 70px; align-self: flex-end;"
                                src="/assets/imgs/iconsDashCanuto/RAM.png"></h2>
                        <p style="height: 60px;">Intercorrências em RAM (50/100)</p>
                    </div>
                    <div class="kpiDash">
                        <h2
                            style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
                            20%<img style="width: 70px; align-self: flex-end;"
                                src="/assets/imgs/iconsDashCanuto/Disco.png"></h2>
                        <p style="height: 60px;">Intercorrências em Disco (20/100)</p>
                    </div>
                    <div class="kpiDash">
                        <h2
                            style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
                            05%<img style="width: 70px; align-self: flex-end;"
                                src="/assets/imgs/iconsDashCanuto/Processos.png"></h2>
                        <p style="height: 60px;">Intercorrências em Processos (05/100)</p>
                    </div>
                </div>
            </div>

            <!-- Info principal 1 -->
            <div style="width: 100%; display: flex; flex-wrap: wrap; flex-direction: row; justify-content: center;">
                <div style="width: 45%;" class="container">
                    <div class="containerHeader">Ranking de intercorrência por modelos (<a
                            class="periodoSelected"></a>):
                    </div>
                    <div class="tabelaWrapper">
                        <table id="rankingModelo" class="tabela">
                            <thead>
                                <tr>
                                    <th>Posição</th>
                                    <th>Modelo</th>
                                    <th>Total de Intercorrências</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
                <div style="width: 45%;" class="container">
                    <div class="containerHeader">Percentual de intercorrências por modelo/componente (<a
                            class="periodoSelected"></a>):
                    </div>
                    <div class="chartContent">
                        <div id="grafMain1"></div>
                    </div>
                </div>

                <!-- Info principal 2 -->
                <div style="width: 92%;" class="container">
                    <div class="containerHeader">Percentual de intercorrências de modelos por top 5 hospitas/modelo (<a
                            class="periodoSelected"></a>):</div>
                    <div class="chartContent">
                        <div id="grafMain2"></div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Visão específica -->
        <div class="divEspecifica">
            <h1 style="margin-left: 70px;">Visão específica:</h1>
            <div style="width: 90%; margin-left: 70px;">
                <select onchange="updateHospital()" class="selects" style="background-color: #39a699;"
                    id="filtroHospital">
                    <option value="">Selecione um hospital...</option>
                    <option value="teste1">teste1</option>
                    <option value="teste2">teste2</option>
                </select>
            </div>


            <div style="width: 100%; display: flex; flex-wrap: wrap; flex-direction: row; justify-content: center;">
                <div style="width: 45%;" class="container">
                    <div class="containerHeader">Ranking de intercorrência por área <a class="hospitalSelected"></a>
                        (<a class="periodoSelected"></a>):</div>
                    <div class="tabelaWrapper">
                        <table id="rankingModelo" class="tabela">
                            <thead>
                                <tr>
                                    <th>Posição</th>
                                    <th>Área</th>
                                    <th>Total de Intercorrências</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>

                <div style="width: 45%;" class="container">
                    <div class="containerHeader">Percentual de intercorrências por área/modelo <a
                            class="hospitalSelected"></a> (<a class="periodoSelected"></a>):</div>
                    <div class="chartContent">
                        <div id="grafEsp1"></div>
                    </div>
                </div>



                <div style="width: 45%;" class="container">
                    <div class="containerHeader">Ranking de intercorrência por modelos <a class="hospitalSelected"></a>
                        (<a class="periodoSelected"></a>):</div>
                    <div class="tabelaWrapper">
                        <table id="rankingModelo" class="tabela">
                            <thead>
                                <tr>
                                    <th>Posição</th>
                                    <th>Modelo</th>
                                    <th>Total de Intercorrências</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>

                <div style="width: 45%;" class="container">
                    <div class="containerHeader">Percentual de intercorrências por modelo/componente <a
                            class="hospitalSelected"></a>
                        (<a class="periodoSelected"></a>):</div>
                    <div class="chartContent">
                        <div id="grafEsp2"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="divPrevisao">
            <h1
                style="padding-left: 70px; color: white; -webkit-text-stroke-width: 1px; -webkit-text-stroke-color: #000;">
                Previsão baseada no estado atual:</h1>

            <div style="width: 100%; display: flex; flex-wrap: wrap; flex-direction: row; justify-content: center;">
                <div style="border-radius: 8px 0px 0px 8px; width: 45%; height: 360px; align-self: center; margin-right: 0px;"
                    class="container">
                    <div style="border-radius: 8px 0px 0px 0px;" class="containerHeader">Previsão de Intercorrências (<a
                            class="periodoSelected"></a>):
                    </div>
                    <div class="chartContent">
                        <div id="grafPrevisao"></div>
                    </div>

                </div>

                <div style="box-shadow: 10x 5px 10px 0px rgba(0, 0, 0, 0.5); border-radius: 0px 8px 8px 0px; margin-left: 0px; flex-direction: column; justify-content: flex-start; padding: 15px; width: 45%; align-self: center; background-color: #264653;"
                    class="container">
                    <div class="previsoes">
                        Aumento de 30% ⬆
                    </div>
                    <div class="previsoes">
                        Diminuição de 30% ⬇
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>




<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function toggleSidebar() {
        const sidebar = document.getElementById("sidebarModal");
        const icone = document.getElementById("icone");

        sidebar.classList.toggle("active");
    }



    function toggleAISidebar() {
        const ai = document.getElementById('aiSidebar');
        ai.classList.toggle('active');
        ai.setAttribute('aria-hidden', ai.classList.contains('active') ? 'false' : 'true');
    }

    function sendToAI() {
        const input = document.getElementById('aiInput');
        const resp = document.getElementById('aiResponse');
        const text = input.value;

        if (!text) {
            resp.innerHTML = '<em>Digite um prompt válido.</em>';
            return;
        }

        resp.innerHTML = 'Processando...';

        gerarResposta(text);
    }


    async function gerarResposta(texto) {
        const resp = document.getElementById('aiResponse');

        const response = await fetch('/ia/perguntar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ texto })
        });

        const data = await response.json();
        
        resp.innerHTML = data.resultado;
    }



    function mostrarNavbar() {
        const larguraTela = window.innerWidth;
        var menu = document.getElementById("navbar");
        var icone = document.getElementById("icone");

        if (larguraTela < 1342) {
            if (getComputedStyle(menu).display == 'none') {
                menu.style.display = "flex";
                icone.classList.remove("fa-bars");
                icone.classList.add("fa-times");
            } else {
                menu.style.display = "none";
                icone.classList.remove("fa-times");
                icone.classList.add("fa-bars");
            }
        }
    }

    function Sair() {
        const sair = document.getElementById("sair")

        if (sair) {
            localStorage.removeItem("email")
            localStorage.removeItem("senha")

            sessionStorage.clear()

            window.location.href = "../../index.html"
        }
    }


    function updatePeriodo() {
        document.querySelectorAll(".periodoSelected").forEach(function (periodoSelected) {
            periodoSelected.innerHTML = `${document.getElementById("filtroPeriodo").value}`;
        });
    }

    function updateHospital() {
        document.querySelectorAll(".hospitalSelected").forEach(function (hospitalSelected) {
            if (document.getElementById("filtroHospital").value == '') {
                hospitalSelected.innerHTML = ``;
            } else {
                hospitalSelected.innerHTML = `no ${document.getElementById("filtroHospital").value}`;
            }
        });
    }


    function inicializacao() {
        updatePeriodo();
    }


    /* ------------------- KPIs -------------------*/

    // mainKPI.innerHTML = `  <div style="width: 100%; display: flex; flex-direction: row; justify-content: center;">
    //                 <div class="kpiDashMain">
    //                     <h2>RAM</h2>Componente com mais intercorrência
    //                 </div>
    //                 <div class="kpiDashMain">
    //                     <h2>100</h2>Total de intercorrências
    //                 </div>
    //             </div>

    //             <div style="width: 100%; display: flex; flex-direction: row; justify-content: center;">
    //                 <div class="kpiDash">
    //                     <h2>25%</h2>Intercorrências em CPU (25/100)
    //                 </div>
    //                 <div class="kpiDash">
    //                     <h2>50%</h2>Intercorrências em RAM (50/100)
    //                 </div>
    //                 <div class="kpiDash">
    //                     <h2>20%</h2>Intercorrências em Disco (20/100)
    //                 </div>
    //                 <div class="kpiDash">
    //                     <h2>05%</h2>Intercorrências em Processos (05/100)
    //                 </div>
    //             </div> `

    // ----------------------------------------------------------------------------------------------------------------------------



    /*-------------------- Dados Principais 1 --------------------*/
    var dadosMain1 = {
        series: [{
            name: "CPU(%)",
            data: [25, 23, 27, 26]
        }, {
            name: "RAM(%)",
            data: [50, 52, 49, 51]
        }, {
            name: "Disco(%)",
            data: [15, 14, 13, 16]
        }, {
            name: "Processos(%)",
            data: [10, 11, 11, 7]
        }],
        colors: ["#83cbc3", "#30a799", "#00796b", "#264653"],
        chart: {
            type: 'bar',
            height: '100%',
            width: '100%'
        },
        plotOptions: {
            bar: {
                horizontal: false,
                dataLabels: {
                    position: 'top',
                },
            }
        },
        dataLabels: {
            enabled: true,
            offsetX: 0,
            style: {
                fontSize: '12px',
                colors: ['#fff']
            }
        },
        stroke: {
            show: true,
            width: 1,
            colors: ['#fff']
        },
        tooltip: {
            shared: true,
            intersect: false
        },
        xaxis: {
            categories: ["Modelo 1", "Modelo 2", "Modelo 3", "Modelo 4"]
        },
    };

    var grafMain1 = new ApexCharts(document.querySelector("#grafMain1"), dadosMain1);
    grafMain1.render();


    /*-------------------- Dados Principais 2 --------------------*/
    var dadosMain2 = {
        series: [{
            name: "Modelo 1",
            data: [25, 23, 27, 26]
        }, {
            name: "Modelo 2",
            data: [50, 52, 49, 51]
        }, {
            name: "Modelo 3",
            data: [15, 14, 13, 16]
        }, {
            name: "Modelo 4",
            data: [10, 11, 11, 7]
        }],
        colors: ["#83cbc3", "#30a799", "#00796b", "#264653"],
        chart: {
            type: 'bar',
            height: '100%',
            width: '100%'
        },
        plotOptions: {
            bar: {
                horizontal: false,
                dataLabels: {
                    position: 'top',
                },
            }
        },
        dataLabels: {
            enabled: true,
            offsetX: 0,
            style: {
                fontSize: '12px',
                colors: ['#fff']
            }
        },
        stroke: {
            show: true,
            width: 1,
            colors: ['#fff']
        },
        tooltip: {
            shared: true,
            intersect: false
        },
        xaxis: {
            categories: ["Hospital 1", "Hospital 2", "Hospital 3", "Hospital 4"]
        },
    };

    var grafMain2 = new ApexCharts(document.querySelector("#grafMain2"), dadosMain2);
    grafMain2.render();




    /*-------------------- Visão específica 1 --------------------*/
    var dadosEsp1 = {
        series: [{
            name: "Modelo 1",
            data: [25, 23, 27, 26]
        }, {
            name: "Modelo 2",
            data: [50, 52, 49, 51]
        }, {
            name: "Modelo 3",
            data: [15, 14, 13, 16]
        }, {
            name: "Modelo 4",
            data: [10, 11, 11, 7]
        }],
        colors: ["#83cbc3", "#30a799", "#00796b", "#264653"],
        chart: {
            type: 'bar',
            height: '100%',
            width: '100%'
        },
        plotOptions: {
            bar: {
                horizontal: false,
                dataLabels: {
                    position: 'top',
                },
            }
        },
        dataLabels: {
            enabled: true,
            offsetX: 0,
            style: {
                fontSize: '12px',
                colors: ['#fff']
            }
        },
        stroke: {
            show: true,
            width: 1,
            colors: ['#fff']
        },
        tooltip: {
            shared: true,
            intersect: false
        },
        xaxis: {
            categories: ["Área 1", "Área 2", "Área 3", "Área 4"]
        },
    };

    var grafEsp1 = new ApexCharts(document.querySelector("#grafEsp1"), dadosEsp1);
    grafEsp1.render();



    /*-------------------- Visão específica 2 --------------------*/
    var dadosEsp2 = {
        series: [{
            name: "CPU(%)",
            data: [25, 23, 27, 26]
        }, {
            name: "RAM(%)",
            data: [50, 52, 49, 51]
        }, {
            name: "Disco(%)",
            data: [15, 14, 13, 16]
        }, {
            name: "Processos(%)",
            data: [10, 11, 11, 7]
        }],
        colors: ["#83cbc3", "#30a799", "#00796b", "#264653"],
        chart: {
            type: 'bar',
            height: '100%',
            width: '100%'
        },
        plotOptions: {
            bar: {
                horizontal: false,
                dataLabels: {
                    position: 'top',
                },
            }
        },
        dataLabels: {
            enabled: true,
            offsetX: 0,
            style: {
                fontSize: '12px',
                colors: ['#fff']
            }
        },
        stroke: {
            show: true,
            width: 1,
            colors: ['#fff']
        },
        tooltip: {
            shared: true,
            intersect: false
        },
        xaxis: {
            categories: ["Modelo 1", "Modelo 2", "Modelo 3", "Modelo 4"]
        },
    };

    var grafEsp2 = new ApexCharts(document.querySelector("#grafEsp2"), dadosEsp2);
    grafEsp2.render();

    /*-------------------- Previsão --------------------*/

    var dadosPrevisao = {
        series: [{
            name: "Intercorrências",
            data: [80, 95, 90, 105, 100, 110, 120, 135, 150]
        }],
        chart: {
            height: '100%',
            type: 'line',
            zoom: {
                enabled: false
            }
        },
        dataLabels: {
            enabled: false
        },
        stroke: {
            curve: 'straight'
        },
        markers: {
            size: 5,
            colors: ['#00000'],
            strokeColors: '#fff',
            strokeWidth: 2,
            hover: {
                size: 7,
            }
        },
        title: {
            text: 'Previsão de intercorrências por semana',
            align: 'left'
        },
        grid: {
            row: {
                colors: ['#f3f3f3', 'transparent'],
                opacity: 0.5
            }
        },
        xaxis: {
            categories: [
                'Semana 1',
                'Semana 2',
                'Semana 3',
                'Semana 4',
                'Semana 5',
                'Semana 6',
                'Semana 7',
                'Semana 8',
                'Semana 9'
            ]
        }
    };




    var grafPrevisao = new ApexCharts(document.querySelector("#grafPrevisao"), dadosPrevisao);
    grafPrevisao.render();
</script>