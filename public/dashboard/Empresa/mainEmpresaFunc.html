<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/assets/imgs/Zephyrus.ico" />
    <link rel="stylesheet" href="./../../css/dashboardsCanuto.css">
    <title>Dashboard - Página Principal</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://kit.fontawesome.com/9f7414eb10.js" crossorigin="anonymous"></script>
    <script src="../../js/sessao.js"></script>

    <!-- CSS Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- JS Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
</head>


<body onload="inicializacao()">
    <div class="div-pai">
        <!-- Cabeçalho -->
        <nav class="navbar corPrincipal fixed-top py-3">
            <div class="container-fluid justify-content-start">
                <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
                    data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="containerTitulo">
                    <div class="logo-titulo">
                        <img src="/assets/imgs/Zephyrus_2png.png" style="width: 50px;" alt="">
                        <h1 class="titulo">Zephyrus</h1>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Menu Offcanvas -->
        <div class="offcanvas offcanvas-start corPrincipal" tabindex="-1" id="offcanvasNavbar"
            aria-labelledby="offcanvasNavbarLabel">
            <img src="/assets/imgs/Zephyrus_2png.png"
                style="width: 136px; align-self: center; margin-bottom: 8px; margin-top: 16px;" alt="">
            <div class="offcanvas-header" style="border-bottom:2px solid rgba(255, 255, 255, 0.5);">
                <h4 class="offcanvas-title" style="color: #f5f6fa;" id="offcanvasNavbarLabel">Menu</h4>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"
                    aria-label="Close"></button>
            </div>
            <div class="offcanvas-body d-flex flex-column">
                <ul class="navbar-nav justify-content-start flex-grow-1 pe-3">
                    <li class="nav-item-selected" style="width: 100%;">
                        <a id="navMain" class="nav-link active" style="padding: 4px; color: #f5f6fa; font-size: 18px;"
                            href="./mainPage.html">Página principal</a>
                    </li>
                    <li class="nav-item" style="width: 100%;">
                        <a class="nav-link active" style="padding: 4px; color: #f5f6fa; font-size: 18px;"
                            href="./controleHospitais.html">Hospitais</a>
                    </li>
                    <li class="nav-item" style="width: 100%;">
                        <a class="nav-link active" style="padding: 4px; color: #f5f6fa; font-size: 18px;"
                            href="./contas.html">Contas</a>
                    </li>
                </ul>
                <ul class="navbar-nav d-flex flex-column pe-1">
                    <li class="nav-item d-flex justify-content-center" style="width: 100%;">
                        <a class="btn-sair" href="/index.html" onclick="sessionStorage.clear()">
                            <img class="icon" src="https://cdn-icons-png.flaticon.com/512/1828/1828479.png"
                                alt="Logout">
                            Sair
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="main-content">
            <div class="fastActions">
                <div>
                    <h4 style="margin: 0px; color: white;">Filtro de períodos:</h4>
                    <select onchange="updatePeriodo()" class="selects"
                        style="height: 20px; background-color: rgb(131, 203, 195);" id="filtroPeriodo">
                        <option value="semanal">Semanal</option>
                        <option value="mensal">Mensal</option>
                        <option value="anual">Anual</option>
                    </select>
                </div>

                <div style="display: flex; flex-direction: row;">
                    <button class="Btn">Gerar relatório</button>
                    <button class="Btn" id="btnIA" onclick="toggleAISidebar()">Analyst AI</button>
                </div>
            </div>




            <!-- Sidebar da direita (IA) -->
            <div id="aiSidebar" class="ai-sidebar" aria-hidden="true">
                <div class="ai-header">
                    <h1>Analyst AI</h1>
                    <button onclick="toggleAISidebar()" class="btn-close btn-close-white"></button>
                </div>
                <div class="ai-body">
                    <p style="font-size: 14px;">Bem-vindo(a)! <br> Tenha uma análise mais profunda com o auxílio da
                        Analyst AI:</p>
                    <textarea style="font-size: 16px;" id="aiInput" placeholder="Digite aqui..." rows="4"
                        onkeydown="enterMensagemIA(event)"></textarea>
                    <button class="Btn" onclick="sendToAI()">Enviar</button>
                    <div id="aiResponse" style="font-size: 14px; margin-top:8px; color:#fff;"></div>
                </div>
            </div>

            <br><br><br><br>

            <div class="conteudo-main">
                <h1 style="margin-bottom: 40px; margin-left: 75px;">Dashboard Principal: Interface de
                    funcionário</h1>


                <!-- Filtro e KPIs -->
                <div id="mainKPI" style="width: 100%; display: flex; flex-direction: column; justify-content: center;">
                    <div style="width: 100%; display: flex; flex-direction: row; justify-content: center;">
                        <div style="border-bottom: rgb(235, 214, 31) solid 4px;" class="kpiDashMain">
                            <h2
                                style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
                                RAM
                                <i class="bi bi-exclamation-circle-fill"
                                    style="font-size: 48px; color: rgb(235, 214, 31);"></i>
                            </h2>
                            <p style="height: 48px;">Componente com mais intercorrência</p>
                        </div>
                        <div style="border-bottom: 1px solid rgb(204, 204, 204);;" class="kpiDashMain">
                            <h2
                                style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
                                100
                                <i class="bi bi-exclamation-circle-fill" style="font-size: 48px; color: black;"></i>
                            </h2>
                            <p style="height: 48px;">Total de intercorrências</p>
                        </div>
                    </div>

                    <div style="width: 100%; display: flex; flex-direction: row; justify-content: center;">
                        <div class="kpiDash">
                            <h2
                                style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
                                25%
                                <i class="bi bi-cpu" style="font-size: 40px;"></i>
                            </h2>
                            <p style="height: 48px;">Intercorrências em CPU (25/100)</p>
                        </div>
                        <div class="kpiDash">
                            <h2
                                style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
                                50%
                                <i class="bi bi-memory" style="font-size: 40px;"></i>
                            </h2>
                            <p style="height: 48px;">Intercorrências em RAM (50/100)</p>
                        </div>
                        <div class="kpiDash">
                            <h2
                                style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
                                20%
                                <i class="bi bi-hdd" style="font-size: 40px;"></i>
                            </h2>
                            <p style="height: 48px;">Intercorrências em Disco (20/100)</p>
                        </div>
                        <div class="kpiDash">
                            <h2
                                style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
                                05%
                                <i class="bi bi-diagram-3" style="font-size: 40px;"></i>
                            </h2>
                            <p style="height: 48px;">Intercorrências em Processos (05/100)</p>
                        </div>
                    </div>
                </div>

                <!-- Info principal 1 -->
                <div style="width: 100%; display: flex; flex-wrap: wrap; flex-direction: row; justify-content: center;">
                    <div style="width: 40%;" class="container">
                        <div class="containerHeader">Ranking de intercorrências por modelos (<a
                                class="periodoSelected"></a>):
                        </div>
                        <div class="tabelaWrapper">
                            <table id="rankingModelo" class="tabela">
                                <thead>
                                    <tr>
                                        <th>Posição</th>
                                        <th>Modelo</th>
                                        <th>Total de Intercorrências</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                    <div style="width: 40%;" class="container">
                        <div class="containerHeader">Percentual de intercorrências por modelo/componente (<a
                                class="periodoSelected"></a>):
                        </div>
                        <div class="chartContent">
                            <div id="grafMain1"></div>
                        </div>
                    </div>

                    <!-- Info principal 2 -->
                    <div class="container">
                        <div class="containerHeader">Percentual de intercorrências de modelos por top 5 hospitas/modelo
                            (<a class="periodoSelected"></a>):</div>
                        <div class="chartContent">
                            <div id="grafMain2"></div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Visão específica -->
            <div class="divEspecifica">
                <h2 style="margin-left: 75px;">Visão específica:</h2>
                <div style="width: 90%; margin-left: 75px;">
                    <select onchange="updateHospital()" class="selects" style="background-color: #39a699;"
                        id="filtroHospital">
                        <option value="">Selecione um hospital...</option>
                        <option value="teste1">teste1</option>
                        <option value="teste2">teste2</option>
                    </select>
                </div>


                <div style="width: 100%; display: flex; flex-wrap: wrap; flex-direction: row; justify-content: center;">
                    <div style="width: 40%;" class="container">
                        <div class="containerHeader">Ranking de intercorrência por área <a class="hospitalSelected"></a>
                            (<a class="periodoSelected"></a>):</div>
                        <div class="tabelaWrapper">
                            <table id="rankingModelo" class="tabela">
                                <thead>
                                    <tr>
                                        <th>Posição</th>
                                        <th>Área</th>
                                        <th>Total de Intercorrências</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>

                    <div style="width: 40%;" class="container">
                        <div class="containerHeader">Percentual de intercorrências por área/modelo <a
                                class="hospitalSelected"></a> (<a class="periodoSelected"></a>):</div>
                        <div class="chartContent">
                            <div id="grafEsp1"></div>
                        </div>
                    </div>



                    <div style="width: 40%;" class="container">
                        <div class="containerHeader">Ranking de intercorrência por modelos <a
                                class="hospitalSelected"></a>
                            (<a class="periodoSelected"></a>):</div>
                        <div class="tabelaWrapper">
                            <table id="rankingModelo" class="tabela">
                                <thead>
                                    <tr>
                                        <th>Posição</th>
                                        <th>Modelo</th>
                                        <th>Total de Intercorrências</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>

                    <div style="width: 40%;" class="container">
                        <div class="containerHeader">Percentual de intercorrências por modelo/componente <a
                                class="hospitalSelected"></a>
                            (<a class="periodoSelected"></a>):</div>
                        <div class="chartContent">
                            <div id="grafEsp2"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="divPrevisao">
                <h2 style="padding-left: 75px;">Previsão baseada no estado atual:</h2>

                <div style="width: 100%; display: flex; flex-wrap: wrap; flex-direction: row; justify-content: center;">

                    <div style="border: none; border-radius: 4px 0px 0px 4px; width: 40%; margin-right: 0px !important;"
                        class="container">
                        <div style="border-radius: 4px 0px 0px 0px;" class="containerHeader">Previsão de Intercorrências
                            (<a class="periodoSelected"></a>):
                        </div>
                        <div class="chartContent">
                            <div id="grafPrevisao"></div>
                        </div>
                    </div>

                    <div class="previsao-container">
                        <div class="previsao-card card-aumento">
                            <span>
                                <h4>Semana 1</h4><br>Previsão de Aumento: 30%
                            </span>
                            <i class="bi bi-graph-up-arrow previsao-icone"></i>
                        </div>

                        <div class="previsao-card card-diminuicao">
                            <span>
                                <h4>Semana 2</h4><br>Previsão de Diminuição: 15%
                            </span>
                            <i class="bi bi-graph-down-arrow previsao-icone"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

</html>




<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function inicializacao() {
        updatePeriodo();







        document.addEventListener('click', function (event) {
            const aiSidebar = document.getElementById('aiSidebar');
            const btnIA = document.getElementById('btnIA');

            if (aiSidebar && aiSidebar.classList.contains('active')) {
                // Se o clique não foi no botão IA ou na sidebar
                if (!btnIA.contains(event.target) && !aiSidebar.contains(event.target)) {
                    aiSidebar.classList.remove('active');
                    aiSidebar.setAttribute('aria-hidden', 'true');
                }
            }
        });
    }




    function toggleSidebar() {
        const sidebar = document.getElementById("sidebarModal");
        const icone = document.getElementById("icone");

        sidebar.classList.toggle("active");
    }

    function mostrarNavbar() {
        const larguraTela = window.innerWidth;
        var menu = document.getElementById("navbar");
        var icone = document.getElementById("icone");

        if (larguraTela < 1342) {
            if (getComputedStyle(menu).display == 'none') {
                menu.style.display = "flex";
                icone.classList.remove("fa-bars");
                icone.classList.add("fa-times");
            } else {
                menu.style.display = "none";
                icone.classList.remove("fa-times");
                icone.classList.add("fa-bars");
            }
        }
    }

    function Sair() {
        const sair = document.getElementById("sair")

        if (sair) {
            localStorage.removeItem("email")
            localStorage.removeItem("senha")

            sessionStorage.clear()

            window.location.href = "../../index.html"
        }
    }







    function toggleAISidebar() {
        const ai = document.getElementById('aiSidebar');
        ai.classList.toggle('active');
        ai.setAttribute('aria-hidden', ai.classList.contains('active') ? 'false' : 'true');
    }

    function enterMensagemIA(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            sendToAI();
        }
    }

    function sendToAI() {
        const input = document.getElementById('aiInput');
        const resp = document.getElementById('aiResponse');
        const text = input.value;

        if (!text) {
            resp.innerHTML = '<em>Digite um prompt válido.</em>';
            return;
        }

        resp.innerHTML = 'Processando...';

        gerarResposta(text);
    }

    async function gerarResposta(texto) {
        const resp = document.getElementById('aiResponse');

        const response = await fetch('/ia/perguntar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ texto })
        });

        const data = await response.json();

        resp.innerHTML = data.resultado;
    }






    function updatePeriodo() {
        document.querySelectorAll(".periodoSelected").forEach(function (periodoSelected) {
            periodoSelected.innerHTML = `${document.getElementById("filtroPeriodo").value}`;
        });
    }

    function updateHospital() {
        document.querySelectorAll(".hospitalSelected").forEach(function (hospitalSelected) {
            if (document.getElementById("filtroHospital").value == '') {
                hospitalSelected.innerHTML = ``;
            } else {
                hospitalSelected.innerHTML = `no ${document.getElementById("filtroHospital").value}`;
            }
        });
    }



    /*----------SCRIPT DATA COLECT----------*/
    async function lerS3() {

    }








    /* ------------------- KPIs -------------------*/

    // mainKPI.innerHTML = ` <div style="width: 100%; display: flex; flex-direction: row; justify-content: center;">
    //                     <div style="border-bottom: rgb(235, 214, 31) solid 4px;" class="kpiDashMain">
    //                         <h2
    //                             style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
    //                             RAM
    //                             <i class="bi bi-exclamation-circle-fill"
    //                                 style="font-size: 48px; color: rgb(235, 214, 31);"></i>
    //                         </h2>
    //                         <p style="height: 48px;">Componente com mais intercorrência</p>
    //                     </div>
    //                     <div style="border-bottom: 1px solid rgb(204, 204, 204);" class="kpiDashMain">
    //                         <h2
    //                             style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
    //                             100
    //                             <i class="bi bi-exclamation-circle-fill" style="font-size: 48px; color: black;"></i>
    //                         </h2>
    //                         <p style="height: 48px;">Total de intercorrências</p>
    //                     </div>
    //                 </div>

    //                 <div style="width: 100%; display: flex; flex-direction: row; justify-content: center;">
    //                     <div class="kpiDash">
    //                         <h2
    //                             style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
    //                             25%
    //                             <i class="bi bi-cpu" style="font-size: 40px;"></i>
    //                         </h2>
    //                         <p style="height: 48px;">Intercorrências em CPU (25/100)</p>
    //                     </div>
    //                     <div class="kpiDash">
    //                         <h2
    //                             style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
    //                             50%
    //                             <i class="bi bi-memory" style="font-size: 40px;"></i>
    //                         </h2>
    //                         <p style="height: 48px;">Intercorrências em RAM (50/100)</p>
    //                     </div>
    //                     <div class="kpiDash">
    //                         <h2
    //                             style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
    //                             20%
    //                             <i class="bi bi-hdd" style="font-size: 40px;"></i>
    //                         </h2>
    //                         <p style="height: 48px;">Intercorrências em Disco (20/100)</p>
    //                     </div>
    //                     <div class="kpiDash">
    //                         <h2
    //                             style="display: flex; flex-direction: row; justify-content: space-between; align-items: center;">
    //                             05%
    //                             <i class="bi bi-diagram-3" style="font-size: 40px;"></i>
    //                         </h2>
    //                         <p style="height: 48px;">Intercorrências em Processos (05/100)</p>
    //                     </div>
    //                 </div> `

    // ----------------------------------------------------------------------------------------------------------------------------






    /*-------------------- Dados Principais 1 --------------------*/
    var dadosMain1 = {
        series: [{
            name: "CPU(%)",
            data: [25, 23, 27, 26]
        }, {
            name: "RAM(%)",
            data: [50, 52, 49, 51]
        }, {
            name: "Disco(%)",
            data: [15, 14, 13, 16]
        }, {
            name: "Processos(%)",
            data: [10, 11, 11, 7]
        }],
        colors: ["#83cbc3", "#30a799", "#00796b", "#264653"],
        chart: {
            type: 'bar',
            height: '100%',
            width: '100%'
        },
        plotOptions: {
            bar: {
                horizontal: false,
                dataLabels: {
                    position: 'top',
                },
            }
        },
        dataLabels: {
            enabled: true,
            offsetX: 0,
            style: {
                fontSize: '12px',
                colors: ['#fff']
            }
        },
        stroke: {
            show: true,
            width: 1,
            colors: ['#fff']
        },
        tooltip: {
            shared: true,
            intersect: false
        },
        xaxis: {
            categories: ["Modelo 1", "Modelo 2", "Modelo 3", "Modelo 4"]
        },
    };

    var grafMain1 = new ApexCharts(document.querySelector("#grafMain1"), dadosMain1);
    grafMain1.render();


    /*-------------------- Dados Principais 2 --------------------*/
    var dadosMain2 = {
        series: [{
            name: "Modelo 1",
            data: [25, 23, 27, 26]
        }, {
            name: "Modelo 2",
            data: [50, 52, 49, 51]
        }, {
            name: "Modelo 3",
            data: [15, 14, 13, 16]
        }, {
            name: "Modelo 4",
            data: [10, 11, 11, 7]
        }],
        colors: ["#83cbc3", "#30a799", "#00796b", "#264653"],
        chart: {
            type: 'bar',
            height: '100%',
            width: '100%'
        },
        plotOptions: {
            bar: {
                horizontal: false,
                dataLabels: {
                    position: 'top',
                },
            }
        },
        dataLabels: {
            enabled: true,
            offsetX: 0,
            style: {
                fontSize: '12px',
                colors: ['#fff']
            }
        },
        stroke: {
            show: true,
            width: 1,
            colors: ['#fff']
        },
        tooltip: {
            shared: true,
            intersect: false
        },
        xaxis: {
            categories: ["Hospital 1", "Hospital 2", "Hospital 3", "Hospital 4"]
        },
    };

    var grafMain2 = new ApexCharts(document.querySelector("#grafMain2"), dadosMain2);
    grafMain2.render();




    /*-------------------- Visão específica 1 --------------------*/
    var dadosEsp1 = {
        series: [{
            name: "Modelo 1",
            data: [25, 23, 27, 26]
        }, {
            name: "Modelo 2",
            data: [50, 52, 49, 51]
        }, {
            name: "Modelo 3",
            data: [15, 14, 13, 16]
        }, {
            name: "Modelo 4",
            data: [10, 11, 11, 7]
        }],
        colors: ["#83cbc3", "#30a799", "#00796b", "#264653"],
        chart: {
            type: 'bar',
            height: '100%',
            width: '100%'
        },
        plotOptions: {
            bar: {
                horizontal: false,
                dataLabels: {
                    position: 'top',
                },
            }
        },
        dataLabels: {
            enabled: true,
            offsetX: 0,
            style: {
                fontSize: '12px',
                colors: ['#fff']
            }
        },
        stroke: {
            show: true,
            width: 1,
            colors: ['#fff']
        },
        tooltip: {
            shared: true,
            intersect: false
        },
        xaxis: {
            categories: ["Área 1", "Área 2", "Área 3", "Área 4"]
        },
    };

    var grafEsp1 = new ApexCharts(document.querySelector("#grafEsp1"), dadosEsp1);
    grafEsp1.render();



    /*-------------------- Visão específica 2 --------------------*/
    var dadosEsp2 = {
        series: [{
            name: "CPU(%)",
            data: [25, 23, 27, 26]
        }, {
            name: "RAM(%)",
            data: [50, 52, 49, 51]
        }, {
            name: "Disco(%)",
            data: [15, 14, 13, 16]
        }, {
            name: "Processos(%)",
            data: [10, 11, 11, 7]
        }],
        colors: ["#83cbc3", "#30a799", "#00796b", "#264653"],
        chart: {
            type: 'bar',
            height: '100%',
            width: '100%'
        },
        plotOptions: {
            bar: {
                horizontal: false,
                dataLabels: {
                    position: 'top',
                },
            }
        },
        dataLabels: {
            enabled: true,
            offsetX: 0,
            style: {
                fontSize: '12px',
                colors: ['#fff']
            }
        },
        stroke: {
            show: true,
            width: 1,
            colors: ['#fff']
        },
        tooltip: {
            shared: true,
            intersect: false
        },
        xaxis: {
            categories: ["Modelo 1", "Modelo 2", "Modelo 3", "Modelo 4"]
        },
    };

    var grafEsp2 = new ApexCharts(document.querySelector("#grafEsp2"), dadosEsp2);
    grafEsp2.render();

    /*-------------------- Previsão --------------------*/

    var dadosPrevisao = {
        series: [{
            name: "Intercorrências",
            data: [80, 95, 90, 105, 100, 110, 120, 135, 150]
        }],
        chart: {
            height: '100%',
            type: 'line',
            zoom: {
                enabled: false
            }
        },
        dataLabels: {
            enabled: false
        },
        stroke: {
            curve: 'straight'
        },
        markers: {
            size: 5,
            colors: ['#00000'],
            strokeColors: '#fff',
            strokeWidth: 2,
            hover: {
                size: 7,
            }
        },
        grid: {
            row: {
                colors: ['#f3f3f3', 'transparent'],
                opacity: 0.5
            }
        },
        xaxis: {
            categories: [
                'Semana 1',
                'Semana 2',
                'Semana 3',
                'Semana 4',
                'Semana 5',
                'Semana 6',
                'Semana 7',
                'Semana 8',
                'Semana 9'
            ]
        }
    };




    var grafPrevisao = new ApexCharts(document.querySelector("#grafPrevisao"), dadosPrevisao);
    grafPrevisao.render();
</script>