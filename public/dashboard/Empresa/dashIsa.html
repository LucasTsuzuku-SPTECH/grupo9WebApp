<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Dashboard de Suporte</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">


    <style>
        body {
            background: #f5f6fa;
            padding-top: 100px;
        }
        .card-kpi {
            text-align: center;
            padding: 20px;
        }
        .card-kpi h3 {
            font-size: 2rem;
        }
        .corPrincipal{
          background:#264653;
        }
        .navbar-toggler-icon {
  filter: invert(1);
  
}
.numeros{
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: flex-start;
  gap: 20px;

}
.numero{
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 25%;
  border-radius: 5px;
}
.numero p{
  color: #f5f6fa;
  font-size: 20px;
  margin: 0px;
  padding: 5px;
}.kpi-row {
    display: flex;
    gap: 20px;
}

.card-kpi {
    flex: 1;              /* faz todas terem o mesmo tamanho */
    height: 100%;         /* para crescer igual */
    min-height: 260px;    /* defina a altura padrão */
    display: flex;
    flex-direction: column;
    justify-content: space-between; /* garante alinhamento bonito */
}
 .containerTitulo .logo-titulo {
  display: flex;
  align-items: center; /* Alinha o logo e título verticalmente */
  gap: 10px;   flex-direction: row;/* Distância entre logo e título */
}


.titulo {
  font-size: 28px;
  font-weight: 600;
  color: white;
  letter-spacing: 1px;
  margin: 0; /* Remover qualquer margem extra */
}


.containerTitulo{
  display: flex;
  align-items: start;
  margin-left: 20px;

}

    </style>
</head>


<!-- FIM DO NAVBAR -->
<body>
    <!-- NAVBAR COM O MENU -->
 <nav class="navbar  corPrincipal fixed-top py-4">
  <div class="container-fluid justify-content-start "> 
       <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon text-white"></span>
    </button>
       <div class="containerTitulo">
      <div class="logo-titulo">
      <img src="/assets/imgs/Zephyrus_2png.png" style="width: 50px;" alt="">
        <h1 class="titulo">Zephyrus</h1>
      </div>     

    <div class="offcanvas offcanvas-start corPrincipal" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title " style="color: #f5f6fa;" id="offcanvasNavbarLabel">Menu</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body d-flex flex-column ">
        <ul class="navbar-nav justify-content-start flex-grow-1 pe-3 ">
          <li class="nav-item">
            <a class="nav-link active" style="color: #f5f6fa; font-size: 25px;" aria-current="page" href="#">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link"  style="color: #f5f6fa;  font-size: 25px;" href="#">Link</a>
          </li>
             
              
      
        </ul>
          
      </div> <img src="/assets/imgs/Zephyrus_2png.png" style="width: 200px; align-self: center; margin-bottom: 50px; " alt="">
    </div>
  </div>
</nav>
    <div class="container">
        <!-- KPIs -->
        <div class="row kpi-row">

            <div class="col-md-4 card-kpi">
                <div class="card shadow-sm card-kpi">
                    <h5>Tempo de resolução médio</h5>
                    <div id="kpiTempo"></div>
                    <small>Últimos 7 dias</small>
                </div>
            </div>

            <div class="col-md-4 card-kpi">
                <div class="card shadow-sm card-kpi">
                    <h5>Chamados Abertos</h5>
                    <div id="chartChamadosAberto"></div>
                 
                    <h3 id="kpiAbertos">36</h3>
                     <h5>Prioridade dos chamados</h5>
               <div class="row d-flex justify-content-between gap-2 mt-2">

  <div class="col p-2 text-center text-white rounded" style="background-color:#e53935;">
      <p class="m-0 fw-bold">Alta</p>
      <p class="m-0">12</p>
  </div>

  <div class="col p-2 text-center text-white rounded" style="background-color:#fbc02d;">
      <p class="m-0 fw-bold">Média</p>
      <p class="m-0">12</p>
  </div>

  <div class="col p-2 text-center text-white rounded" style="background-color:#43a047;">
      <p class="m-0 fw-bold">Baixa</p>
      <p class="m-0">12</p>
  </div>

</div>

                     <!--  <div class="numeros">
                     
                      <div class="numero" style="background-color: #e53935">
                        <p>Alta</p><p>50</p>
                      </div>
                      <div class="numero" style="background-color: #fbc02d">
                        <p>Média</p>
                        <p>25</p>
                      </div>
                      <div class="numero" style="background-color: #43a047"><p>
                        Baixa
                      </p><p>50</p></div>

                    </div>
                      -->
                   
                    <small>Em tempo real</small>
                </div>
            </div>

            <div class="col-md-4 card-kpi">
                <div class="card shadow-sm card-kpi">
                <h5>Chamados resolvidos</h5>
                                    <div class="kpiResolvidosCharts" id="kpiResolvidosChart"></div>
                               <small>Em tempo real</small>
                   

   

                    
                </div>
            </div>
        </div>
        <div class="row mt-4">
    <div class="col-md-12">
        <div class="card shadow-sm p-3">
            <h5 class="mb-3">Chamados que Ameaçam a SLA</h5>

            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle">
                    <thead style="background-color: #264653;">
                        <tr>
                            <th>ID</th>
                            <th>Título</th>
                            <th>Prioridade</th>
                            <th>Responsável</th>
                            <th>Tempo Restante</th>
                            <th>Hospital</th>
                            <th>Area</th>
                        </tr>
                    </thead>
                    <tbody id="tabelaSLA">
                        <!-- Linhas serão inseridas via JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


        <!-- GRÁFICOS -->
        <div class="row mt-4 g-4">
            <div class="col-md-6">
                <div class="card shadow-sm p-3">
                    <h5 class="mb-3">Chamados Criados x Resolvidos (Semana)</h5>
                    <div id="graficoChamados"></div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card shadow-sm p-3">
                    <h5 class="mb-3">Categorias x Status (Heatmap)</h5>
                    <div id="heatmap"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPT DOS GRÁFICOS -->
   

</body>
</html>

  

  


   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>

window.onload(plotarGraficoTempo(),plotarGraficoResolucao(),plotarGraficoChamadosAbertos())
        // ================================
        // KPI - Radial % Resolvidos
 
        // ================================
function plotarGraficoResolucao(){
const valor = 12; // sua porcentagem real

// Função para definir a cor baseada no valor
function corPorPercentual(p) {
    if (p <= 40) return '#e53935';  // vermelho
    if (p <= 70) return '#fbc02d';  // amarelo
    return '#43a047';               // verde
}

var optionsResolvidos = {
    series: [valor],
    chart: {
        height: 185,
        type: 'radialBar',
    },
    plotOptions: {
        radialBar: {
            startAngle: -90,
            endAngle: 90,
            hollow: {
                size: '70%'
            },
            track: {
                background: '#eee',
                strokeWidth: '100%'
            },
            dataLabels: {
                name: {
                    show: false,
                    text: 'Resolvidos',
                    offsetY: 20,
                    fontSize: '16px'
                },
                value: {
                    show: true,
                    offsetY: -20,
                    fontSize: '28px',
                    fontWeight: 600,
                    formatter: () => valor + "%"
                }
            }
        }
        
    },
    fill: {
        colors: [corPorPercentual(valor)]
    },
    stroke: {
        lineCap: 'round'
    }
    
};

var chartResolvidos = new ApexCharts(document.querySelector("#kpiResolvidosChart"), optionsResolvidos);
chartResolvidos.render();}

//GRAFICO DA KPI DE TEMPO

function plotarGraficoTempo(){

        var graficoTempoOptions = {
          series: [{
          data: [2,5,4,5,84,47,54]
        }],
          chart: {
          type: 'area',
          height: 144,
          sparkline: {
            enabled: true
          },
        },
        stroke: {
          curve: 'straight'
        },
        fill: {
          opacity: 0.3,
        },
        yaxis: {
          min: 0
        },
        colors: ['#30a799'],
        title: {
          text: '120 min',
          offsetX: 0,
          
          style: {
            fontSize: '24px',
          
          }
        }
        };

        var chartTempo = new ApexCharts(document.querySelector("#kpiTempo"), graficoTempoOptions);
        chartTempo.render();

      }
 



        // ================================
        // Gráfico de Barras
        // ================================
        var graficoChamadosOptions = {
            series: [
                { name: "Criados", data: [12, 17, 14, 20, 10, 8, 22] },
                { name: "Resolvidos", data: [10, 15, 12, 18, 9, 7, 20] }
            ],
            chart: { type: 'bar', height: 300 },
            xaxis: {
                categories: ["Seg", "Ter", "Qua", "Qui", "Sex", "Sab", "Dom"]
            }
        };
        var graficoChamados = new ApexCharts(document.querySelector("#graficoChamados"), graficoChamadosOptions);
        graficoChamados.render();


        // ================================
        // Heatmap - Categorias x Status
        // ================================
        var heatmapOptions = {
            chart: { height: 300, type: 'heatmap' },
            series: [
                { name: "Erro Técnico", data: [5, 10, 2, 7] },
                { name: "Atualização", data: [3, 8, 1, 4] },
                { name: "Configuração", data: [6, 12, 3, 9] }
            ],
            xaxis: {
                categories: ["Aberto", "Em Andamento", "Aguardando Cliente", "Resolvido"]
            },
            dataLabels: { enabled: false }
        };
        var heatmap = new ApexCharts(document.querySelector("#heatmap"), heatmapOptions);
        heatmap.render();


        // ================================
        // Preenchendo KPIs
        // (Você atualiza aqui com sua API depois)
        // ================================
        document.getElementById("kpiTempo").innerText = "132";
        document.getElementById("kpiAbertos").innerText = "18";
    </script>
<script src="../js/chart.js"></script>
<script>
  

  async function buscarChamados(params) {
  const emailJira = "zephyrus2g@gmail.com"
  const tokenJira = "ATATT3xFfGF05iWRDCXKhXZYF3yapED-KyRdzr9O-ZTQuM-cAn0_i_LDjiHqJCa6k_XEGkcsrsiRaYLWY5FBP5DcgGyZPMC-RDocHaKZ31N3IhAr-QHnwvdFfoJ7TUTDshD-3DC_3f7aVwUoqWSXSHElna4JT9Hk-NDohn6FFyi8lqwAYl42ZEY=6045C37E";
  const dominioJira = "zephyrus2g1.atlassian.net";
  const auth = btoa(`${emailJira}:${tokenJira}`)
    try {
      const resposta = await fetch("/jira/buscarChamadosJira")


      const data = await resposta.json();
      console.log(data)
      //COLOCANDO AS INFORMAÇÕES EM UM VETOR
      const chamados=[]
    data.issues.forEach(chamado => {
      const campo=chamado.fields
      chamados.push({
        id:chamado.id,
        titulo:campo.summary,
        prioridade:campo.priority.name,
        data_criacao:campo.created,
        hospital:campo.customfield_10091,
        area:campo.customfield_10092,
        responsavel:campo.assignee,
        status:campo.status.name


      })
        
      });
console.log(chamados)

    } catch (error) {
      console.log(error)

    }

  }
  buscarChamados()
  
      
        var options = {
          series: [76],
          chart: {
          type: 'radialBar',
          offsetY: -20,
          sparkline: {
            enabled: true
          }
        },
        plotOptions: {
          radialBar: {
            startAngle: -90,
            endAngle: 90,
            track: {
              background: "#e7e7e7",
              strokeWidth: '97%',
              margin: 5, // margin is in pixels
              dropShadow: {
                enabled: true,
                top: 2,
                left: 0,
                color: '#444',
                opacity: 1,
                blur: 2
              }
            },
            dataLabels: {
              name: {
                show: false
              },
              value: {
                offsetY: -2,
                fontSize: '22px'
              }
            }
          }
        },
        grid: {
          padding: {
            top: -10
          }
        },
        fill: {
          type: 'gradient',
          gradient: {
            shade: 'light',
            shadeIntensity: 0.4,
            inverseColors: false,
            opacityFrom: 1,
            opacityTo: 1,
            stops: [0, 50, 53, 91]
          },
        },
        labels: ['Average Results'],
        };

        var chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();
</script>